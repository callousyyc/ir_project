# IRç³»ç»Ÿæµ‹è¯•éªŒè¯æŒ‡å—

## âœ… é—®é¢˜å·²ä¿®å¤

### ä¿®å¤å†…å®¹

* âœ… ç§»é™¤æ‰€æœ‰64ä½å¾ªç¯è®¡æ•°å™¨è°ƒç”¨
* âœ… æ”¹ç”¨32ä½ `k_cycle_get_32()`
* âœ… æ·»åŠ æº¢å‡ºå¤„ç†é€»è¾‘
* âœ… æ›´æ–°æ•°æ®ç±»å‹ä¸º `uint32_t`

### å½±å“çš„æ–‡ä»¶

1. `src/ir_hal.c` - GPIOä¸­æ–­å¤„ç†
2. `src/ir_learning.c` - å­¦ä¹ æ¨¡å—æ—¶é—´æˆ³

## ğŸ”§ é‡æ–°ç¼–è¯‘

```bash
# æ¸…ç†æ—§çš„ç¼–è¯‘æ–‡ä»¶
rm -rf build

# é‡æ–°ç¼–è¯‘
west build -b nrf52840dk/nrf52840

# çƒ§å½•
west flash
```

## ğŸ§ª æµ‹è¯•æ­¥éª¤

### é˜¶æ®µ1: åŸºç¡€åŠŸèƒ½æµ‹è¯•

#### 1.1 ç³»ç»Ÿå¯åŠ¨æµ‹è¯•

 **æœŸæœ›è¾“å‡º** :

```
*** Booting Zephyr OS build ... ***
[00:00:00.xxx] <inf> ir_hal: IR HAL initialized
[00:00:00.xxx] <inf> ir_service: IR Service initialized
[00:00:00.xxx] <inf> ir_learning: IR Learning initialized
[00:00:00.xxx] <inf> ir_app: Loading Samsung TV database...
```

 **éªŒè¯** : æ— ASSERTIONé”™è¯¯

---

#### 1.2 IRDBå‘é€æµ‹è¯•

```bash
# è¿æ¥ä¸²å£
screen /dev/ttyACM0 115200

# æµ‹è¯•å‘é€
ir> ir send Power

# æœŸæœ›è¾“å‡ºï¼š
[00:00:xx.xxx] <inf> ir_service: Sent: Power (1 repeats)
```

 **éªŒè¯** :

* âœ… æ— å´©æºƒ
* âœ… IR LEDé—ªçƒï¼ˆç”¨æ‰‹æœºæ‘„åƒå¤´å¯è§ï¼‰

---

#### 1.3 IRDBæ¥æ”¶æµ‹è¯•

```bash
# å¯åŠ¨æ¥æ”¶
ir> ir receive 10

# å¯¹å‡†æ¥æ”¶å™¨æŒ‰é¥æ§å™¨æŒ‰é”®
# æœŸæœ›è¾“å‡ºï¼š
[00:00:xx.xxx] <inf> ir_service: Received: Power
[00:00:xx.xxx] <inf> ir_service:   Protocol: 1, Device: 7.7, Function: 2
```

 **éªŒè¯** :

* âœ… èƒ½æ£€æµ‹åˆ°ä¿¡å·
* âœ… æ— ASSERTIONé”™è¯¯
* âœ… æ­£ç¡®è§£ç 

---

### é˜¶æ®µ2: è‡ªå­¦ä¹ åŠŸèƒ½æµ‹è¯•

#### 2.1 å­¦ä¹ æµ‹è¯•

```bash
# å­¦ä¹ Poweré”®
ir> irlearn learn Test_Power 10000

# ç³»ç»Ÿæç¤ºï¼š
Learning started: 'Test_Power', timeout: 10000 ms
Waiting for signal...
Please press the button on your remote control

# æŒ‰ä¸‹é¥æ§å™¨æŒ‰é”®åï¼š
Signal detected, recording...
Learning: Completed!
  Name: Test_Power
  Edges: 68
  Duration: 67500 us
```

 **éªŒè¯** :

* âœ… èƒ½æ£€æµ‹ä¿¡å·
* âœ… è®°å½•äº†åˆç†æ•°é‡çš„edges (é€šå¸¸20-200)
* âœ… æ— å´©æºƒ

---

#### 2.2 é‡æ”¾æµ‹è¯•

```bash
# é‡æ”¾å­¦ä¹ çš„ä¿¡å·
ir> irlearn replay Test_Power

# æœŸæœ›è¾“å‡ºï¼š
[00:00:xx.xxx] <inf> ir_learning: Replaying signal: 'Test_Power' (68 edges, 1 repeats)
[00:00:xx.xxx] <inf> ir_learning: Replay completed
```

 **éªŒè¯** :

* âœ… é¥æ§ç›®æ ‡è®¾å¤‡æœ‰å“åº”
* âœ… IR LEDé—ªçƒ
* âœ… æ— é”™è¯¯

---

#### 2.3 ä¿¡å·åˆ†ææµ‹è¯•

```bash
# åˆ†æä¿¡å·ç‰¹å¾
ir> irlearn analyze Test_Power

# æœŸæœ›è¾“å‡ºï¼š
Signal Analysis: Test_Power
  Pulse count: 68
  Avg mark: 560 us
  Avg space: 1120 us
  Min pulse: 560 us
  Max pulse: 9000 us
  Estimated carrier: 38000 Hz
```

 **éªŒè¯** :

* âœ… æ•°æ®åˆç†ï¼ˆè½½æ³¢é€šå¸¸36-40kHzï¼‰
* âœ… æ— å´©æºƒ

---

#### 2.4 ä¿¡å·ä¿å­˜å’ŒåŠ è½½æµ‹è¯•

```bash
# åˆ—å‡ºå·²ä¿å­˜çš„ä¿¡å·
ir> irlearn list

# æœŸæœ›è¾“å‡ºï¼š
Learned signals:
  Test_Power
```

 **éªŒè¯** :

* âœ… ä¿¡å·å·²ä¿å­˜
* âœ… é‡å¯åä»ç„¶å­˜åœ¨ï¼ˆå¦‚æœå¯ç”¨äº†æ–‡ä»¶ç³»ç»Ÿï¼‰

---

### é˜¶æ®µ3: å‹åŠ›æµ‹è¯•

#### 3.1 è¿ç»­æ¥æ”¶æµ‹è¯•

```bash
# é•¿æ—¶é—´æ¥æ”¶
ir> ir receive 300  # 5åˆ†é’Ÿ

# è¿ç»­æŒ‰é¥æ§å™¨å¤šæ¬¡
# éªŒè¯ï¼šæ— å†…å­˜æ³„æ¼ï¼Œæ— å´©æºƒ
```

---

#### 3.2 è¿ç»­å‘é€æµ‹è¯•

```bash
# å¿«é€Ÿè¿ç»­å‘é€
ir> ir send Power
ir> ir send Power
ir> ir send Power
ir> ir send Power
ir> ir send Power

# éªŒè¯ï¼šæ‰€æœ‰å‘é€æˆåŠŸï¼Œæ— å´©æºƒ
```

---

#### 3.3 å­¦ä¹ -é‡æ”¾å¾ªç¯æµ‹è¯•

```bash
# å¤šæ¬¡å­¦ä¹ å’Œé‡æ”¾
for i in {1..10}; do
    irlearn learn Signal_$i 5000
    # æŒ‰é¥æ§å™¨
    sleep 7
    irlearn replay Signal_$i
    sleep 2
done

# éªŒè¯ï¼šæ‰€æœ‰æ“ä½œæˆåŠŸ
```

---

### é˜¶æ®µ4: è¾¹ç•Œæ¡ä»¶æµ‹è¯•

#### 4.1 è¶…æ—¶æµ‹è¯•

```bash
# å­¦ä¹ ä½†ä¸æŒ‰é¥æ§å™¨
ir> irlearn learn NoSignal 5000

# 5ç§’åæœŸæœ›è¾“å‡ºï¼š
Learning: Timeout - no signal detected

# éªŒè¯ï¼šæ­£å¸¸è¶…æ—¶ï¼Œæ— å´©æºƒ
```

---

#### 4.2 å™ªå£°æµ‹è¯•

```bash
# åœ¨æœ‰é˜³å…‰æˆ–å¼ºå…‰ä¸‹æµ‹è¯•
ir> ir receive 10

# å¯èƒ½çœ‹åˆ°çŸ­è„‰å†²ï¼ˆå™ªå£°ï¼‰
# éªŒè¯ï¼šè¿‡æ»¤æ‰ < 50us çš„è„‰å†²
```

---

#### 4.3 å†…å­˜å‹åŠ›æµ‹è¯•

```bash
# å­¦ä¹ å¤§é‡ä¿¡å·
for i in {1..20}; do
    irlearn learn Signal_$i
    # æŒ‰é¥æ§å™¨
    sleep 5
done

# æ£€æŸ¥å†…å­˜ä½¿ç”¨
ir> kernel uptime
ir> kernel threads

# éªŒè¯ï¼šæ— å†…å­˜è€—å°½
```

---

## ğŸ“Š é¢„æœŸç»“æœæ€»ç»“

### æ­£å¸¸è¾“å‡ºç¤ºä¾‹

```
*** Booting Zephyr OS ***
[00:00:00.256] <inf> ir_hal: IR HAL initialized
[00:00:00.257] <inf> ir_service: IR Service initialized  
[00:00:00.258] <inf> ir_learning: IR Learning initialized
[00:00:00.259] <inf> ir_app: Loading Samsung TV database...
[00:00:00.260] <inf> ir_app: Loaded remote: Samsung TV

ir> ir list
Remote: Samsung TV
Functions (24):
  Power                P:1 D:7.7 F:2
  Vol+                 P:1 D:7.7 F:7
  Vol-                 P:1 D:7.7 F:11
  ...

ir> ir send Power
[00:00:05.123] <inf> ir_service: Sent: Power (1 repeats)

ir> irlearn learn MyPower
Learning started...
Waiting for signal...
[00:00:07.456] <inf> ir_learning: Signal detected, recording...
[00:00:07.789] <inf> ir_learning: Completed! 68 edges

ir> irlearn replay MyPower
[00:00:10.234] <inf> ir_learning: Replaying signal...
[00:00:10.345] <inf> ir_learning: Replay completed
```

### é”™è¯¯æŒ‡ç¤ºå™¨

âŒ  **å¦‚æœçœ‹åˆ°è¿™äº›ï¼Œè¯´æ˜æœ‰é—®é¢˜** :

```
ASSERTION FAIL
Kernel panic
Hard fault
Memory allocation failed
```

âœ… **æ­£å¸¸æƒ…å†µä¸åº”è¯¥çœ‹åˆ°è¿™äº›é”™è¯¯**

---

## ğŸ” è°ƒè¯•æŠ€å·§

### 1. æŸ¥çœ‹è¯¦ç»†æ—¥å¿—

åœ¨ `prj.conf` ä¸­ï¼š

```conf
CONFIG_LOG_MODE_IMMEDIATE=y
CONFIG_LOG_LEVEL_DBG=y
```

### 2. æ£€æŸ¥GPIOçŠ¶æ€

```bash
# åœ¨Shellä¸­æŸ¥çœ‹GPIOé…ç½®
ir> device list
```

### 3. å†…å­˜ä½¿ç”¨

```bash
ir> kernel uptime
ir> kernel stacks
```

### 4. ä½¿ç”¨é€»è¾‘åˆ†æä»ª

è¿æ¥åˆ°ï¼š

* P0.13 (TX) - åº”è¯¥çœ‹åˆ°38kHzè½½æ³¢
* P0.14 (RX) - åº”è¯¥çœ‹åˆ°è¾“å…¥ä¿¡å·

---

## ğŸ¯ æˆåŠŸæ ‡å‡†

### âœ… ç³»ç»Ÿæ­£å¸¸å·¥ä½œçš„æ ‡å¿—

1. **å¯åŠ¨æ­£å¸¸**
   * æ— ASSERTIONé”™è¯¯
   * æ‰€æœ‰æ¨¡å—åˆå§‹åŒ–æˆåŠŸ
2. **IRDBåŠŸèƒ½æ­£å¸¸**
   * èƒ½å‘é€é¢„å®šä¹‰ä¿¡å·
   * èƒ½æ¥æ”¶å¹¶è§£ç ä¿¡å·
   * æ•°æ®åº“æ­£ç¡®åŠ è½½
3. **å­¦ä¹ åŠŸèƒ½æ­£å¸¸**
   * èƒ½æ•è·IRä¿¡å·
   * ä¿¡å·å¯é‡æ”¾
   * åˆ†ææ•°æ®åˆç†
   * ä¿å­˜/åŠ è½½æ­£å¸¸
4. **ç¨³å®šæ€§**
   * é•¿æ—¶é—´è¿è¡Œæ— å´©æºƒ
   * å†…å­˜ä½¿ç”¨ç¨³å®š
   * å“åº”åŠæ—¶

---

## ğŸ› å¸¸è§é—®é¢˜è¯Šæ–­

### é—®é¢˜: æ¥æ”¶ä¸åˆ°ä¿¡å·

 **æ£€æŸ¥** :

1. IRæ¥æ”¶å™¨æ˜¯å¦è¿æ¥åˆ°P0.14
2. æ¥æ”¶å™¨VCCå’ŒGNDæ˜¯å¦æ­£ç¡®
3. é¥æ§å™¨ç”µæ± æ˜¯å¦æœ‰ç”µ
4. è·ç¦»æ˜¯å¦åˆé€‚ï¼ˆ5-30cmï¼‰

 **æµ‹è¯•** :

```bash
# æ£€æŸ¥GPIO
ir> device list
# æŸ¥æ‰¾gpio0è®¾å¤‡çŠ¶æ€
```

---

### é—®é¢˜: å‘é€ä¸å·¥ä½œ

 **æ£€æŸ¥** :

1. IR LEDæ˜¯å¦è¿æ¥åˆ°P0.13
2. é©±åŠ¨ç”µè·¯æ˜¯å¦æ­£å¸¸
3. ç”¨æ‰‹æœºæ‘„åƒå¤´æŸ¥çœ‹LEDæ˜¯å¦å‘å…‰

 **æµ‹è¯•** :

```bash
# ç®€å•æµ‹è¯•PWM
ir> ir send Power
# ç”¨æ‰‹æœºæ‘„åƒå¤´åº”è¯¥èƒ½çœ‹åˆ°LEDé—ªçƒ
```

---

### é—®é¢˜: å­¦ä¹ çš„ä¿¡å·æ— æ³•é‡æ”¾

 **æ£€æŸ¥** :

1. å­¦ä¹ æ—¶æ•è·çš„edgesæ•°é‡ï¼ˆåº”è¯¥>20ï¼‰
2. åˆ†æä¿¡å·ç‰¹å¾æ˜¯å¦åˆç†

 **æµ‹è¯•** :

```bash
ir> irlearn analyze Signal1
# æ£€æŸ¥pulse countå’Œcarrier frequency
```

---

## ğŸ“ æµ‹è¯•æŠ¥å‘Šæ¨¡æ¿

```
æµ‹è¯•æ—¥æœŸ: ____________________
å›ºä»¶ç‰ˆæœ¬: ____________________
å¼€å‘æ¿: nRF52840DK

[é˜¶æ®µ1] åŸºç¡€åŠŸèƒ½
  [ ] ç³»ç»Ÿå¯åŠ¨
  [ ] IRDBå‘é€
  [ ] IRDBæ¥æ”¶
  
[é˜¶æ®µ2] è‡ªå­¦ä¹ 
  [ ] ä¿¡å·å­¦ä¹ 
  [ ] ä¿¡å·é‡æ”¾
  [ ] ä¿¡å·åˆ†æ
  [ ] ä¿å­˜/åŠ è½½
  
[é˜¶æ®µ3] å‹åŠ›æµ‹è¯•
  [ ] è¿ç»­æ¥æ”¶
  [ ] è¿ç»­å‘é€
  [ ] å­¦ä¹ -é‡æ”¾å¾ªç¯
  
[é˜¶æ®µ4] è¾¹ç•Œæµ‹è¯•
  [ ] è¶…æ—¶å¤„ç†
  [ ] å™ªå£°è¿‡æ»¤
  [ ] å†…å­˜å‹åŠ›

æ€»ä½“è¯„ä»·: ____________________
é—®é¢˜è®°å½•: ____________________
```

ç°åœ¨é‡æ–°ç¼–è¯‘å¹¶æµ‹è¯•ï¼Œåº”è¯¥ä¸ä¼šå†æœ‰ASSERTIONé”™è¯¯äº†ï¼ğŸ‰
